<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>최근 10년간 장마철 기상 데이터 분석</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 45vh;
            width: 100%;
        }
        .chart-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1f2937;
        }
        /* Glassmorphism 효과를 위한 클래스 */
        .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .metric-toggle-btn {
            transition: all 0.3s ease;
        }
        .metric-toggle-btn.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .metric-toggle-btn:not(.active) {
            background-color: rgba(255,255,255,0.7);
            color: #374151;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-200 via-cyan-100 to-green-200 text-gray-800">

    <header class="bg-white/80 backdrop-blur-sm shadow-lg sticky top-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-center text-slate-800">
                <i class="fas fa-cloud-showers-heavy mr-3 text-blue-500"></i>최근 10년 장마철 기상 분석
            </h1>
            <p class="text-center text-slate-600 mt-2">지난 10년간의 장마철 강수량, 기온, 습도 데이터를 비교 분석합니다.</p>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        
        <!-- 연도별 개요 섹션 -->
        <div class="glass-card p-6 rounded-2xl shadow-xl mb-8">
            <h2 class="text-2xl font-bold text-center mb-4 text-slate-700">연도별 데이터 개요</h2>
             <div class="flex flex-col md:flex-row justify-center items-center gap-4">
                <label for="year-select" class="text-lg font-semibold text-gray-700"><i class="fas fa-calendar-alt mr-2"></i>분석 연도 선택:</label>
                <select id="year-select" class="bg-white/80 p-3 border-2 border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                    <!-- 옵션은 JS로 채워집니다. -->
                </select>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-6">
                <!-- 지역별 데이터 비교 차트 -->
                <div class="bg-white/30 p-6 rounded-xl shadow-lg">
                    <h3 id="regional-chart-title" class="chart-title"></h3>
                    <div class="flex justify-center mb-4">
                        <div class="inline-flex rounded-md shadow-sm" role="group">
                            <button type="button" id="toggle-temp" class="metric-toggle-btn active py-2 px-4 text-sm font-medium rounded-l-lg border border-gray-200">
                                <i class="fas fa-temperature-half mr-1"></i>평균 기온
                            </button>
                            <button type="button" id="toggle-humidity" class="metric-toggle-btn py-2 px-4 text-sm font-medium rounded-r-lg border border-gray-200">
                                <i class="fas fa-tint mr-1"></i>평균 습도
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="regionalComparisonChart"></canvas>
                    </div>
                </div>

                <!-- 데이터 테이블 섹션 -->
                <div class="bg-white/30 p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center">
                        <h3 id="data-table-title" class="chart-title"></h3>
                        <button id="download-csv" class="mb-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            <i class="fas fa-download mr-2"></i>CSV 다운로드
                        </button>
                    </div>
                     <div class="overflow-y-auto h-[45vh]">
                        <table id="data-table" class="min-w-full bg-white/70 border border-gray-200 rounded-lg">
                            <thead class="bg-slate-800 text-white sticky top-0">
                                <tr>
                                    <th class="py-3 px-4 uppercase font-semibold text-sm text-left rounded-tl-lg">지역</th>
                                    <th class="py-3 px-4 uppercase font-semibold text-sm text-left">총 강수량 (mm)</th>
                                    <th class="py-3 px-4 uppercase font-semibold text-sm text-left">평균 기온 (°C)</th>
                                    <th class="py-3 px-4 uppercase font-semibold text-sm text-left rounded-tr-lg">평균 습도 (%)</th>
                                </tr>
                            </thead>
                            <tbody id="data-table-body" class="text-gray-700">
                                <!-- 데이터는 JS로 채워집니다. -->
                            </tbody>
                        </table>
                     </div>
                </div>
            </div>
        </div>

        <!-- 10년 추이 분석 섹션 -->
        <div class="glass-card p-6 rounded-2xl shadow-xl my-8">
            <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-4">
                <h2 class="text-2xl font-bold text-center text-slate-700">10년간 기상 변화 추이</h2>
                <select id="trend-subject-select" class="bg-white/80 p-3 border-2 border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                    <option value="National">전국 평균</option>
                    <!-- 지역 옵션은 JS로 채워집니다. -->
                </select>
            </div>
            <div class="chart-container" style="height: 50vh;">
                <canvas id="trendChart"></canvas>
            </div>
        </div>
        
        <!-- 연도별 비교 분석 섹션 -->
        <div class="glass-card p-6 rounded-2xl shadow-xl my-8">
            <h2 class="text-2xl font-bold text-center text-slate-700 mb-4">연도별 데이터 비교</h2>
            <div class="flex flex-col md:flex-row justify-center items-center gap-6">
                 <div class="flex items-center gap-2">
                    <label for="year1-select" class="text-lg font-semibold text-blue-600">비교 연도 1:</label>
                    <select id="year1-select" class="bg-white/80 p-3 border-2 border-blue-300 rounded-lg shadow-sm"></select>
                 </div>
                 <i class="fas fa-exchange-alt text-2xl text-slate-600 hidden md:block"></i>
                 <div class="flex items-center gap-2">
                    <label for="year2-select" class="text-lg font-semibold text-green-600">비교 연도 2:</label>
                    <select id="year2-select" class="bg-white/80 p-3 border-2 border-green-300 rounded-lg shadow-sm"></select>
                 </div>
            </div>
             <div class="chart-container mt-6" style="height: 50vh;">
                <canvas id="comparisonChart"></canvas>
            </div>
        </div>

    </main>

    <footer class="text-center py-6 mt-12 bg-slate-800/90 text-gray-200">
        <p>&copy; 2024 기상 데이터 분석 프로젝트. All rights reserved.</p>
    </footer>

    <script>
        // --- Mock 데이터 (2015-2024) ---
        const weatherData = [
            { year: 2015, region: '서울', rainfall: 380, temperature: 25.1, humidity: 82 }, { year: 2015, region: '부산', rainfall: 450, temperature: 26.0, humidity: 88 }, { year: 2015, region: '대구', rainfall: 320, temperature: 26.5, humidity: 80 }, { year: 2015, region: '광주', rainfall: 410, temperature: 25.8, humidity: 85 }, { year: 2015, region: '대전', rainfall: 360, temperature: 25.3, humidity: 83 }, { year: 2015, region: '제주', rainfall: 550, temperature: 27.1, humidity: 90 },
            { year: 2016, region: '서울', rainfall: 420, temperature: 25.5, humidity: 85 }, { year: 2016, region: '부산', rainfall: 480, temperature: 26.3, humidity: 89 }, { year: 2016, region: '대구', rainfall: 350, temperature: 26.8, humidity: 82 }, { year: 2016, region: '광주', rainfall: 450, temperature: 26.1, humidity: 87 }, { year: 2016, region: '대전', rainfall: 390, temperature: 25.7, humidity: 84 }, { year: 2016, region: '제주', rainfall: 600, temperature: 27.5, humidity: 92 },
            { year: 2017, region: '서울', rainfall: 350, temperature: 26.0, humidity: 79 }, { year: 2017, region: '부산', rainfall: 410, temperature: 26.8, humidity: 85 }, { year: 2017, region: '대구', rainfall: 290, temperature: 27.2, humidity: 77 }, { year: 2017, region: '광주', rainfall: 380, temperature: 26.5, humidity: 82 }, { year: 2017, region: '대전', rainfall: 330, temperature: 26.1, humidity: 80 }, { year: 2017, region: '제주', rainfall: 520, temperature: 28.0, humidity: 88 },
            { year: 2018, region: '서울', rainfall: 550, temperature: 24.8, humidity: 88 }, { year: 2018, region: '부산', rainfall: 620, temperature: 25.5, humidity: 91 }, { year: 2018, region: '대구', rainfall: 480, temperature: 25.9, humidity: 86 }, { year: 2018, region: '광주', rainfall: 590, temperature: 25.2, humidity: 90 }, { year: 2018, region: '대전', rainfall: 520, temperature: 25.0, humidity: 89 }, { year: 2018, region: '제주', rainfall: 750, temperature: 26.5, humidity: 94 },
            { year: 2019, region: '서울', rainfall: 310, temperature: 26.5, humidity: 78 }, { year: 2019, region: '부산', rainfall: 380, temperature: 27.2, humidity: 84 }, { year: 2019, region: '대구', rainfall: 250, temperature: 27.8, humidity: 75 }, { year: 2019, region: '광주', rainfall: 350, temperature: 27.0, humidity: 81 }, { year: 2019, region: '대전', rainfall: 290, temperature: 26.7, humidity: 79 }, { year: 2019, region: '제주', rainfall: 480, temperature: 28.5, humidity: 87 },
            { year: 2020, region: '서울', rainfall: 680, temperature: 24.5, humidity: 90 }, { year: 2020, region: '부산', rainfall: 750, temperature: 25.2, humidity: 93 }, { year: 2020, region: '대구', rainfall: 610, temperature: 25.5, humidity: 88 }, { year: 2020, region: '광주', rainfall: 720, temperature: 24.9, humidity: 92 }, { year: 2020, region: '대전', rainfall: 650, temperature: 24.7, humidity: 91 }, { year: 2020, region: '제주', rainfall: 880, temperature: 26.0, humidity: 95 },
            { year: 2021, region: '서울', rainfall: 450, temperature: 25.8, humidity: 83 }, { year: 2021, region: '부산', rainfall: 510, temperature: 26.6, humidity: 87 }, { year: 2021, region: '대구', rainfall: 390, temperature: 27.0, humidity: 81 }, { year: 2021, region: '광주', rainfall: 480, temperature: 26.3, humidity: 86 }, { year: 2021, region: '대전', rainfall: 430, temperature: 25.9, humidity: 84 }, { year: 2021, region: '제주', rainfall: 620, temperature: 27.8, humidity: 90 },
            { year: 2022, region: '서울', rainfall: 580, temperature: 25.2, humidity: 86 }, { year: 2022, region: '부산', rainfall: 650, temperature: 26.0, humidity: 90 }, { year: 2022, region: '대구', rainfall: 510, temperature: 26.4, humidity: 84 }, { year: 2022, region: '광주', rainfall: 620, temperature: 25.7, humidity: 89 }, { year: 2022, region: '대전', rainfall: 560, temperature: 25.4, humidity: 87 }, { year: 2022, region: '제주', rainfall: 780, temperature: 27.2, humidity: 93 },
            { year: 2023, region: '서울', rainfall: 620, temperature: 25.0, humidity: 89 }, { year: 2023, region: '부산', rainfall: 700, temperature: 25.8, humidity: 92 }, { year: 2023, region: '대구', rainfall: 550, temperature: 26.1, humidity: 87 }, { year: 2023, region: '광주', rainfall: 670, temperature: 25.5, humidity: 91 }, { year: 2023, region: '대전', rainfall: 600, temperature: 25.2, humidity: 90 }, { year: 2023, region: '제주', rainfall: 820, temperature: 27.0, humidity: 94 },
            { year: 2024, region: '서울', rainfall: 480, temperature: 26.2, humidity: 81 }, { year: 2024, region: '부산', rainfall: 550, temperature: 27.0, humidity: 86 }, { year: 2024, region: '대구', rainfall: 410, temperature: 27.5, humidity: 79 }, { year: 2024, region: '광주', rainfall: 520, temperature: 26.8, humidity: 84 }, { year: 2024, region: '대전', rainfall: 460, temperature: 26.4, humidity: 82 }, { year: 2024, region: '제주', rainfall: 650, temperature: 28.2, humidity: 89 },
        ];

        let regionalChart, trendChart, comparisonChart;
        let currentMetric = 'temperature';
        const allYears = [...new Set(weatherData.map(d => d.year))].sort((a, b) => b - a);
        const allRegions = [...new Set(weatherData.map(d => d.region))];

        document.addEventListener('DOMContentLoaded', () => {
            // --- Element Caching ---
            const yearSelect = document.getElementById('year-select');
            const toggleTempBtn = document.getElementById('toggle-temp');
            const toggleHumidityBtn = document.getElementById('toggle-humidity');
            const downloadCsvBtn = document.getElementById('download-csv');
            const trendSubjectSelect = document.getElementById('trend-subject-select');
            const year1Select = document.getElementById('year1-select');
            const year2Select = document.getElementById('year2-select');
            
            // --- Populate Selectors ---
            populateSelector(yearSelect, allYears, (y) => `${y}년`);
            populateSelector(trendSubjectSelect, allRegions, (r) => r, false);
            populateSelector(year1Select, allYears, (y) => `${y}년`);
            populateSelector(year2Select, allYears, (y) => `${y}년`);
            year1Select.value = allYears[0];
            year2Select.value = allYears[1];

            // --- Initial Render ---
            updateYearlyOverview();
            drawTrendChart();
            drawComparisonChart();

            // --- Event Listeners ---
            yearSelect.addEventListener('change', updateYearlyOverview);
            downloadCsvBtn.addEventListener('click', downloadCSV);
            trendSubjectSelect.addEventListener('change', drawTrendChart);
            year1Select.addEventListener('change', drawComparisonChart);
            year2Select.addEventListener('change', drawComparisonChart);
            
            toggleTempBtn.addEventListener('click', () => setMetric('temperature'));
            toggleHumidityBtn.addEventListener('click', () => setMetric('humidity'));
        });

        function populateSelector(selectElement, items, formatter, shouldClear = true) {
            if (shouldClear) selectElement.innerHTML = '';
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = formatter(item);
                selectElement.appendChild(option);
            });
        }
        
        function setMetric(metric) {
            currentMetric = metric;
            document.getElementById('toggle-temp').classList.toggle('active', metric === 'temperature');
            document.getElementById('toggle-humidity').classList.toggle('active', metric === 'humidity');
            updateYearlyOverview();
        }

        function updateYearlyOverview() {
            const selectedYear = parseInt(document.getElementById('year-select').value);
            drawRegionalComparisonChart(selectedYear);
            populateDataTable(selectedYear);
        }

        function drawRegionalComparisonChart(year) {
            const yearData = weatherData.filter(d => d.year === year);
            const isTemp = currentMetric === 'temperature';
            const metricData = yearData.map(d => isTemp ? d.temperature : d.humidity);
            const metricLabel = isTemp ? '평균 기온 (°C)' : '평균 습도 (%)';
            const metricColor = isTemp ? 'rgba(255, 99, 132, 1)' : 'rgba(255, 159, 64, 1)';

            const ctx = document.getElementById('regionalComparisonChart').getContext('2d');
            if (regionalChart) regionalChart.destroy();
            
            regionalChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: allRegions,
                    datasets: [
                        { label: '강수량 (mm)', data: yearData.map(d => d.rainfall), backgroundColor: 'rgba(54, 162, 235, 0.7)', yAxisID: 'y' },
                        { label: metricLabel, data: metricData, borderColor: metricColor, backgroundColor: metricColor, type: 'line', yAxisID: 'y1', tension: 0.3 }
                    ]
                },
                options: getChartOptions({ y1Label: metricLabel, y1Min: isTemp ? 20 : 70, y1Max: isTemp ? 30 : 100 })
            });
            document.getElementById('regional-chart-title').textContent = `${year}년 지역별 데이터`;
        }
        
        function drawTrendChart() {
            const subject = document.getElementById('trend-subject-select').value;
            let trendData;
            
            if (subject === 'National') {
                trendData = allYears.map(year => {
                    const yearData = weatherData.filter(d => d.year === year);
                    return {
                        year: year,
                        rainfall: yearData.reduce((s, c) => s + c.rainfall, 0) / yearData.length,
                        temperature: yearData.reduce((s, c) => s + c.temperature, 0) / yearData.length,
                        humidity: yearData.reduce((s, c) => s + c.humidity, 0) / yearData.length,
                    };
                }).reverse();
            } else {
                trendData = weatherData.filter(d => d.region === subject);
            }

            const ctx = document.getElementById('trendChart').getContext('2d');
            if (trendChart) trendChart.destroy();
            
            trendChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: trendData.map(d => d.year),
                    datasets: [
                        { label: '강수량 (mm)', data: trendData.map(d => d.rainfall), backgroundColor: 'rgba(54, 162, 235, 0.7)', yAxisID: 'y' },
                        { label: '평균 기온 (°C)', data: trendData.map(d => d.temperature), borderColor: 'rgba(255, 99, 132, 1)', type: 'line', yAxisID: 'y1', tension: 0.3 },
                        { label: '평균 습도 (%)', data: trendData.map(d => d.humidity), borderColor: 'rgba(255, 159, 64, 1)', type: 'line', yAxisID: 'y2', tension: 0.3 }
                    ]
                },
                options: getChartOptions({ y1Label: '평균 기온 (°C)', y2Label: '평균 습도 (%)', y1Min: 20, y1Max: 30, y2Min: 70, y2Max: 100 })
            });
        }
        
        function drawComparisonChart() {
            const year1 = parseInt(document.getElementById('year1-select').value);
            const year2 = parseInt(document.getElementById('year2-select').value);

            if (year1 === year2) return; // 같은 연도는 비교하지 않음

            const year1Data = weatherData.filter(d => d.year === year1);
            const year2Data = weatherData.filter(d => d.year === year2);
            
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            if (comparisonChart) comparisonChart.destroy();

            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: allRegions,
                    datasets: [
                        { label: `${year1}년 강수량 (mm)`, data: year1Data.map(d => d.rainfall), backgroundColor: 'rgba(54, 162, 235, 0.7)' },
                        { label: `${year2}년 강수량 (mm)`, data: year2Data.map(d => d.rainfall), backgroundColor: 'rgba(75, 192, 192, 0.7)' }
                    ]
                },
                options: getChartOptions({})
            });
        }

        function populateDataTable(year) {
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = '';
            weatherData.filter(d => d.year === year).forEach(d => {
                const row = document.createElement('tr');
                row.className = "border-b border-gray-200/50 hover:bg-white/50";
                row.innerHTML = `
                    <td class="py-3 px-4">${d.region}</td>
                    <td class="py-3 px-4">${d.rainfall.toFixed(1)}</td>
                    <td class="py-3 px-4">${d.temperature.toFixed(1)}</td>
                    <td class="py-3 px-4">${d.humidity.toFixed(1)}</td>
                `;
                tableBody.appendChild(row);
            });
             document.getElementById('data-table-title').textContent = `${year}년 상세 데이터`;
        }

        function downloadCSV() {
            const year = document.getElementById('year-select').value;
            const yearData = weatherData.filter(d => d.year == year);
            
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
            csvContent += "지역,총 강수량(mm),평균 기온(°C),평균 습도(%)\n";
            
            yearData.forEach(row => {
                csvContent += `${row.region},${row.rainfall},${row.temperature},${row.humidity}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `monsoon_data_${year}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function getChartOptions({ y1Label, y2Label, y1Min, y1Max, y2Min, y2Max }) {
             const options = {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: { legend: { position: 'top' } },
                scales: {
                    x: { grid: { display: false } },
                    y: { type: 'linear', position: 'left', title: { display: true, text: '강수량 (mm)', font: { weight: 'bold' } }, beginAtZero: true }
                }
            };
            if(y1Label) {
                options.scales.y1 = { type: 'linear', position: 'right', title: { display: true, text: y1Label, font: { weight: 'bold' } }, grid: { drawOnChartArea: false }, min: y1Min, max: y1Max };
            }
            if(y2Label) {
                 options.scales.y2 = { type: 'linear', position: 'right', title: { display: true, text: y2Label, font: { weight: 'bold' } }, grid: { drawOnChartArea: false }, min: y2Min, max: y2Max, ticks: { display: false } }; // y2 축은 제목만 표시
            }
            return options;
        }
    </script>
</body>
</html>
