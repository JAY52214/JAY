<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>최근 10년간 장마철 기상 데이터 분석</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 50vh;
            width: 90vw;
            max-width: 1000px;
        }
        .chart-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #1f2937;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-center text-gray-900">
                <i class="fas fa-cloud-showers-heavy mr-3 text-blue-500"></i>최근 10년 장마철 기상 분석
            </h1>
            <p class="text-center text-gray-600 mt-2">지난 10년간의 장마철 강수량, 기온, 습도 데이터를 비교 분석합니다.</p>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <!-- 컨트롤 섹션 -->
        <div class="bg-white p-6 rounded-xl shadow-lg mb-8 flex flex-col md:flex-row justify-center items-center gap-4">
            <label for="year-select" class="text-lg font-semibold text-gray-700"><i class="fas fa-calendar-alt mr-2"></i>분석 연도 선택:</label>
            <select id="year-select" class="p-3 border-2 border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                <!-- 옵션은 JS로 채워집니다. -->
            </select>
        </div>

        <!-- 차트 섹션 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- 지역별 데이터 비교 차트 -->
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 id="regional-chart-title" class="chart-title"></h2>
                <div class="chart-container" style="height: 55vh;">
                    <canvas id="regionalComparisonChart"></canvas>
                </div>
            </div>

            <!-- 전국 평균 데이터 트렌드 차트 -->
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="chart-title"><i class="fas fa-chart-line mr-2"></i>전국 평균 장마철 기상 변화 (10년)</h2>
                <div class="chart-container" style="height: 55vh;">
                    <canvas id="nationalTrendChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- 데이터 테이블 섹션 -->
        <div class="mt-10 bg-white p-6 rounded-xl shadow-lg">
             <h2 id="data-table-title" class="chart-title"></h2>
             <div class="overflow-x-auto">
                <table id="data-table" class="min-w-full bg-white border border-gray-200">
                    <thead class="bg-gray-800 text-white">
                        <tr>
                            <th class="py-3 px-4 uppercase font-semibold text-sm text-left">지역</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm text-left">총 강수량 (mm)</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm text-left">평균 기온 (°C)</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm text-left">평균 습도 (%)</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body" class="text-gray-700">
                        <!-- 데이터는 JS로 채워집니다. -->
                    </tbody>
                </table>
             </div>
        </div>
    </main>

    <footer class="text-center py-6 mt-8 bg-gray-800 text-white">
        <p>&copy; 2024 기상 데이터 분석 프로젝트. All rights reserved.</p>
    </footer>

    <script>
        // --- Mock 데이터 (2015-2024) ---
        // 실제 데이터 대신 시연을 위한 가상 데이터입니다.
        const weatherData = [
            // ... 2015-2023 데이터 생략 ...
            { year: 2015, region: '서울', rainfall: 380, temperature: 25.1, humidity: 82 },
            { year: 2015, region: '부산', rainfall: 450, temperature: 26.0, humidity: 88 },
            { year: 2015, region: '대구', rainfall: 320, temperature: 26.5, humidity: 80 },
            { year: 2015, region: '광주', rainfall: 410, temperature: 25.8, humidity: 85 },
            { year: 2015, region: '대전', rainfall: 360, temperature: 25.3, humidity: 83 },
            { year: 2015, region: '제주', rainfall: 550, temperature: 27.1, humidity: 90 },
            
            { year: 2016, region: '서울', rainfall: 420, temperature: 25.5, humidity: 85 },
            { year: 2016, region: '부산', rainfall: 480, temperature: 26.3, humidity: 89 },
            { year: 2016, region: '대구', rainfall: 350, temperature: 26.8, humidity: 82 },
            { year: 2016, region: '광주', rainfall: 450, temperature: 26.1, humidity: 87 },
            { year: 2016, region: '대전', rainfall: 390, temperature: 25.7, humidity: 84 },
            { year: 2016, region: '제주', rainfall: 600, temperature: 27.5, humidity: 92 },

            { year: 2017, region: '서울', rainfall: 350, temperature: 26.0, humidity: 79 },
            { year: 2017, region: '부산', rainfall: 410, temperature: 26.8, humidity: 85 },
            { year: 2017, region: '대구', rainfall: 290, temperature: 27.2, humidity: 77 },
            { year: 2017, region: '광주', rainfall: 380, temperature: 26.5, humidity: 82 },
            { year: 2017, region: '대전', rainfall: 330, temperature: 26.1, humidity: 80 },
            { year: 2017, region: '제주', rainfall: 520, temperature: 28.0, humidity: 88 },

            { year: 2018, region: '서울', rainfall: 550, temperature: 24.8, humidity: 88 },
            { year: 2018, region: '부산', rainfall: 620, temperature: 25.5, humidity: 91 },
            { year: 2018, region: '대구', rainfall: 480, temperature: 25.9, humidity: 86 },
            { year: 2018, region: '광주', rainfall: 590, temperature: 25.2, humidity: 90 },
            { year: 2018, region: '대전', rainfall: 520, temperature: 25.0, humidity: 89 },
            { year: 2018, region: '제주', rainfall: 750, temperature: 26.5, humidity: 94 },

            { year: 2019, region: '서울', rainfall: 310, temperature: 26.5, humidity: 78 },
            { year: 2019, region: '부산', rainfall: 380, temperature: 27.2, humidity: 84 },
            { year: 2019, region: '대구', rainfall: 250, temperature: 27.8, humidity: 75 },
            { year: 2019, region: '광주', rainfall: 350, temperature: 27.0, humidity: 81 },
            { year: 2019, region: '대전', rainfall: 290, temperature: 26.7, humidity: 79 },
            { year: 2019, region: '제주', rainfall: 480, temperature: 28.5, humidity: 87 },

            { year: 2020, region: '서울', rainfall: 680, temperature: 24.5, humidity: 90 },
            { year: 2020, region: '부산', rainfall: 750, temperature: 25.2, humidity: 93 },
            { year: 2020, region: '대구', rainfall: 610, temperature: 25.5, humidity: 88 },
            { year: 2020, region: '광주', rainfall: 720, temperature: 24.9, humidity: 92 },
            { year: 2020, region: '대전', rainfall: 650, temperature: 24.7, humidity: 91 },
            { year: 2020, region: '제주', rainfall: 880, temperature: 26.0, humidity: 95 },

            { year: 2021, region: '서울', rainfall: 450, temperature: 25.8, humidity: 83 },
            { year: 2021, region: '부산', rainfall: 510, temperature: 26.6, humidity: 87 },
            { year: 2021, region: '대구', rainfall: 390, temperature: 27.0, humidity: 81 },
            { year: 2021, region: '광주', rainfall: 480, temperature: 26.3, humidity: 86 },
            { year: 2021, region: '대전', rainfall: 430, temperature: 25.9, humidity: 84 },
            { year: 2021, region: '제주', rainfall: 620, temperature: 27.8, humidity: 90 },

            { year: 2022, region: '서울', rainfall: 580, temperature: 25.2, humidity: 86 },
            { year: 2022, region: '부산', rainfall: 650, temperature: 26.0, humidity: 90 },
            { year: 2022, region: '대구', rainfall: 510, temperature: 26.4, humidity: 84 },
            { year: 2022, region: '광주', rainfall: 620, temperature: 25.7, humidity: 89 },
            { year: 2022, region: '대전', rainfall: 560, temperature: 25.4, humidity: 87 },
            { year: 2022, region: '제주', rainfall: 780, temperature: 27.2, humidity: 93 },

            { year: 2023, region: '서울', rainfall: 620, temperature: 25.0, humidity: 89 },
            { year: 2023, region: '부산', rainfall: 700, temperature: 25.8, humidity: 92 },
            { year: 2023, region: '대구', rainfall: 550, temperature: 26.1, humidity: 87 },
            { year: 2023, region: '광주', rainfall: 670, temperature: 25.5, humidity: 91 },
            { year: 2023, region: '대전', rainfall: 600, temperature: 25.2, humidity: 90 },
            { year: 2023, region: '제주', rainfall: 820, temperature: 27.0, humidity: 94 },

            { year: 2024, region: '서울', rainfall: 480, temperature: 26.2, humidity: 81 },
            { year: 2024, region: '부산', rainfall: 550, temperature: 27.0, humidity: 86 },
            { year: 2024, region: '대구', rainfall: 410, temperature: 27.5, humidity: 79 },
            { year: 2024, region: '광주', rainfall: 520, temperature: 26.8, humidity: 84 },
            { year: 2024, region: '대전', rainfall: 460, temperature: 26.4, humidity: 82 },
            { year: 2024, region: '제주', rainfall: 650, temperature: 28.2, humidity: 89 },
        ];

        // --- 전역 변수 ---
        let regionalChart;
        let nationalTrendChart;

        const yearSelect = document.getElementById('year-select');
        const regionalChartTitle = document.getElementById('regional-chart-title');
        const dataTableTitle = document.getElementById('data-table-title');

        // --- 초기화 함수 ---
        document.addEventListener('DOMContentLoaded', () => {
            // 연도 선택 옵션 채우기
            const years = [...new Set(weatherData.map(d => d.year))].sort((a, b) => b - a);
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${year}년`;
                yearSelect.appendChild(option);
            });

            // 이벤트 리스너 등록
            yearSelect.addEventListener('change', (e) => {
                updateVisualizations(parseInt(e.target.value));
            });
            
            // 초기 차트 및 테이블 렌더링
            const latestYear = years[0];
            updateVisualizations(latestYear);
            
            // 전국 평균 트렌드 차트 렌더링 (한 번만 실행)
            drawNationalTrendChart(years.sort((a,b)=> a-b));
        });

        // --- 시각화 업데이트 함수 ---
        function updateVisualizations(year) {
            yearSelect.value = year;
            regionalChartTitle.textContent = `${year}년 지역별 기상 데이터 비교`;
            dataTableTitle.textContent = `${year}년 상세 데이터`;
            
            drawRegionalComparisonChart(year);
            populateDataTable(year);
        }

        // --- 차트 렌더링 함수 ---

        // 1. 선택된 연도의 지역별 데이터 비교 차트
        function drawRegionalComparisonChart(year) {
            const ctx = document.getElementById('regionalComparisonChart').getContext('2d');
            const yearData = weatherData.filter(d => d.year === year);
            const regions = yearData.map(d => d.region);
            const rainfallData = yearData.map(d => d.rainfall);
            const tempData = yearData.map(d => d.temperature);
            const humidityData = yearData.map(d => d.humidity);

            if (regionalChart) {
                regionalChart.destroy();
            }

            regionalChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: regions,
                    datasets: [
                        {
                            label: '강수량 (mm)',
                            data: rainfallData,
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            yAxisID: 'y',
                            barPercentage: 0.5, // 막대그래프 폭을 50%로 설정
                            categoryPercentage: 0.8 // 카테고리 내 공간 할당 비율
                        },
                        {
                            label: '평균 기온 (°C)',
                            data: tempData,
                            backgroundColor: 'rgba(255, 99, 132, 0.7)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1,
                            type: 'line',
                            yAxisID: 'y1',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y;
                                        if (context.dataset.yAxisID === 'y') {
                                           label += ' mm';
                                        } else {
                                           label += ' °C';
                                        }
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false }
                        },
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: '강수량 (mm)',
                                font: { weight: 'bold' }
                            },
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            title: {
                                display: true,
                                text: '평균 기온 (°C)',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                drawOnChartArea: false // y1 축의 그리드 라인은 그리지 않음
                            },
                            min: 20,
                            max: 30
                        }
                    }
                }
            });
        }
        
        // 2. 전국 평균 10년 트렌드 차트
        function drawNationalTrendChart(years) {
            const nationalAverages = years.map(year => {
                const yearData = weatherData.filter(d => d.year === year);
                const avgRainfall = yearData.reduce((sum, d) => sum + d.rainfall, 0) / yearData.length;
                const avgTemp = yearData.reduce((sum, d) => sum + d.temperature, 0) / yearData.length;
                const avgHumidity = yearData.reduce((sum, d) => sum + d.humidity, 0) / yearData.length;
                return { year, avgRainfall, avgTemp, avgHumidity };
            });

            const ctx = document.getElementById('nationalTrendChart').getContext('2d');
            if (nationalTrendChart) {
                nationalTrendChart.destroy();
            }
            nationalTrendChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: years.map(y => `${y}년`),
                    datasets: [
                        {
                            label: '평균 강수량 (mm)',
                            data: nationalAverages.map(d => d.avgRainfall.toFixed(1)),
                            backgroundColor: 'rgba(75, 192, 192, 0.7)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            yAxisID: 'y',
                            barPercentage: 0.5, // 막대그래프 폭을 50%로 설정
                            categoryPercentage: 0.8 // 카테고리 내 공간 할당 비율
                        },
                        {
                            label: '평균 기온 (°C)',
                            data: nationalAverages.map(d => d.avgTemp.toFixed(1)),
                            type: 'line',
                            borderColor: 'rgba(255, 159, 64, 1)',
                            backgroundColor: 'rgba(255, 159, 64, 0.7)',
                            yAxisID: 'y1',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: '평균 강수량 (mm)', font: { weight: 'bold' } },
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            title: { display: true, text: '평균 기온 (°C)', font: { weight: 'bold' } },
                            grid: { drawOnChartArea: false },
                            min: 22,
                            max: 28
                        }
                    }
                }
            });
        }

        // --- 데이터 테이블 채우기 함수 ---
        function populateDataTable(year) {
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = ''; // 기존 데이터 삭제

            const yearData = weatherData.filter(d => d.year === year);
            yearData.forEach(d => {
                const row = `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-3 px-4">${d.region}</td>
                        <td class="py-3 px-4">${d.rainfall.toFixed(1)}</td>
                        <td class="py-3 px-4">${d.temperature.toFixed(1)}</td>
                        <td class="py-3 px-4">${d.humidity.toFixed(1)}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
    </script>
</body>
</html>
